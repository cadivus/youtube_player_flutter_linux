<!DOCTYPE html>
<html>
<head>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            background-color: #000000;
            overflow: hidden;
            position: fixed;
            height: 100%;
            width: 100%;
            pointer-events: none;
        }
    </style>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no'>
</head>
<body>
<div id="player"></div>
<script>
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
  var player;
  var timerId;

  // Sends a message depending on the webview implementation
  function callDartHandler(name, ...args) {
    if (window.flutter_inappwebview && window.flutter_inappwebview.callHandler) {
      window.flutter_inappwebview.callHandler(name, ...args);
      return;
    }

    try {
      eval(name)(JSON.stringify(args));
      return;
    } catch (_) {
      // Nothing here
    }
  }

  function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
      height: '100%',
      width: '100%',

      // string: controller!.initialVideoId
      videoId: /*>initialVideoId START<*/'gQDByCdjUXw'/*>initialVideoId END<*/,

      playerVars: {
        'controls': 0,
        'playsinline': 1,
        'enablejsapi': 1,
        'fs': 0,
        'rel': 0,
        'showinfo': 0,
        'iv_load_policy': 3,
        'modestbranding': 1,

        // bool: controller!.flags.enableCaption
        'cc_load_policy': /*>enableCaption START<*/false/*>enableCaption END<*/,

        // string: controller!.flags.captionLanguage
        'cc_lang_pref': /*>captionLanguage START<*/'en'/*>captionLanguage END<*/,

        // bool: controller!.flags.autoPlay
        'autoplay': /*>autoPlay START<*/false/*>autoPlay END<*/,

        // int: controller!.flags.startAt
        'start': /*>startAt START<*/0/*>startAt END<*/,

        // int?: controller!.flags.endAt
        'end': /*>endAt START<*/null/*>endAt END<*/,
      },
      events: {
        onReady: function (event) {
          callDartHandler('Ready');
        },
        onStateChange: function (event) {
          sendPlayerStateChange(event.data);
        },
        onPlaybackQualityChange: function (event) {
          console.log(event.data);
          callDartHandler('PlaybackQualityChange', event.data);
        },
        onPlaybackRateChange: function (event) {
          callDartHandler('PlaybackRateChange', event.data);
        },
        onError: function (error) {
          callDartHandler('Errors', error.data);
        }
      },
    });
  }

  function sendPlayerStateChange(playerState) {
    clearTimeout(timerId);
    callDartHandler('StateChange', playerState);
    if (playerState == 1) {
      startSendCurrentTimeInterval();
      sendVideoData(player);
    }
  }

  function sendVideoData(player) {
    var videoData = {
      'duration': player.getDuration(),
      'title': player.getVideoData().title,
      'author': player.getVideoData().author,
      'videoId': player.getVideoData().video_id
    };
    callDartHandler('VideoData', videoData);
  }

  function startSendCurrentTimeInterval() {
    timerId = setInterval(function () {
      callDartHandler('VideoTime', player.getCurrentTime(), player.getVideoLoadedFraction());
    }, 100);
  }

  function play() {
    player.playVideo();
    return '';
  }

  function pause() {
    player.pauseVideo();
    return '';
  }

  function loadById(loadSettings) {
    player.loadVideoById(loadSettings);
    return '';
  }

  function cueById(cueSettings) {
    player.cueVideoById(cueSettings);
    return '';
  }

  function loadPlaylist(playlist, index, startAt) {
    player.loadPlaylist(playlist, 'playlist', index, startAt);
    return '';
  }

  function cuePlaylist(playlist, index, startAt) {
    player.cuePlaylist(playlist, 'playlist', index, startAt);
    return '';
  }

  function mute() {
    player.mute();
    return '';
  }

  function unMute() {
    player.unMute();
    return '';
  }

  function setVolume(volume) {
    player.setVolume(volume);
    return '';
  }

  function seekTo(position, seekAhead) {
    player.seekTo(position, seekAhead);
    return '';
  }

  function setSize(width, height) {
    player.setSize(width, height);
    return '';
  }

  function setPlaybackRate(rate) {
    player.setPlaybackRate(rate);
    return '';
  }

  function setTopMargin(margin) {
    document.getElementById("player").style.marginTop = margin;
    return '';
  }
</script>
</body>
</html>
